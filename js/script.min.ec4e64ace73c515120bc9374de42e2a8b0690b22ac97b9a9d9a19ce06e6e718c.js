(function(){function e(e,t,n){var s;return(...o)=>{var i=()=>{s=null,n||e.apply(this,o)},a=n&&!s;clearTimeout(s),s=setTimeout(i,t),a&&e.apply(this,o)}}function t(e){var t,s,o=e.querySelector("img"),n=e.querySelector(".poi-scroll");window.addEventListener("mousemove",function(e){t&&(e.which===1?(n.scrollLeft=s[0]+(t[0]-e.pageX),n.scrollTop=s[1]+(t[1]-e.pageY)):t=!1)}),o.addEventListener("mousedown",function(e){s=[n.scrollLeft,n.scrollTop],t=[e.pageX,e.pageY]}),window.addEventListener("mouseup",function(){t=!1})}class n{constructor(){this.boulders=[],this.goals=[],this.layout=[[1,1,1],[1,0,1],[1,1,1]],this.PUSH_CHECKS=[["left",[-1,0]],["right",[1,0]],["up",[0,-1]],["down",[0,1]]],this.BOMB_CHECKS=[["upleft",-1,-1],["upright",1,-1],["downleft",-1,1],["downright",1,1]]}prepare(e,t,n){this.layout=e,this.boulders=t.filter(([e,t])=>t!==-1).map(e=>[e[0],e[1]]),this.goals=n.filter(([e,t])=>t!==-1).map(e=>[e[0],e[1]])}run(e,t,n){this._testedPositions={},this.hasTestedPosition(this.boulders,0,0),this._depthLimit=t,this._explosiveLimit=n;let s=Date.now();this._forceStop=s+e*1e3-1;const o=this.search({explosives:0,move:"start",boulders:this.boulders},0);return{solution:o||[],stats:{duration:Date.now()-s,positions:Object.values(this._testedPositions).length}}}pushBoulder(e,t,n){const o=this.layout,i=e[t][0]-n[0],a=e[t][1]-n[1];if(o[a][i]===2)return;if(e.findIndex(e=>e[0]===i&&e[1]===a)!==-1)return;const s=[...e];let r=!1;for(;!0;){const a=s[t],e=a[0]+n[0],i=a[1]+n[1],c=s.findIndex(t=>t[0]===e&&t[1]===i);if(c!==-1){t=c;continue}if(o[i][e]!==0)break;s[t]=[e,i],r=!0}if(!r)return;return s}bombBoulders(e,t){const n=this.layout;if(n[t[1]][t[0]]===2)return;if(e.findIndex(e=>e[0]===t[0]&&e[1]===t[1])!==-1)return;const i=e.filter(e=>e[0]>=t[0]-1&&e[0]<=t[0]+1&&e[1]>=t[1]-1&&e[1]<=t[1]+1&&(e[0]!==t[0]||e[1]!==t[1])),s=[...e];let o=!1;for(const a of i){let r=e.indexOf(a);const c=[a[0]-t[0],a[1]-t[1]];for(;!0;){const e=s[r],t=e[0]+c[0],i=e[1]+c[1],a=s.findIndex(e=>e[0]===t&&e[1]===i);if(a!==-1){r=a;continue}if(n[i][t]!==0||n[i][e[0]]===2||n[e[1]][t]===2)break;s[r]=[t,i],o=!0}}if(!o)return;return s}hasTestedPosition(e,t,n){let o="",i;for(i of e.map(e=>""+e[0]+e[1]).sort())o+=i;let s=this._testedPositions[o];if(s){if(s.explosives<n||s.explosives===n&&s.depth<=t)return!0;s.depth=t,s.explosives=n}else this._testedPositions[o]={depth:t,explosives:n};return!1}getPossibleMoves(e,t){const s=e.boulders,n=e.explosives,o=[],i=[],a=n<this._explosiveLimit;for(let e=0;e<s.length;e++){const r=s[e];for(const[a,c]of this.PUSH_CHECKS){const i=this.pushBoulder(s,e,c);i&&!this.hasTestedPosition(i,t+1,n)&&o.push({pos:r,move:a,explosives:n,boulders:i})}if(a)for(const[u,l,d]of this.BOMB_CHECKS){const e=[r[0]+l,r[1]+d],c=e[0]+","+e[1];if(i.indexOf(c)!==-1)continue;i.push(c);const a=this.bombBoulders(s,e);a&&!this.hasTestedPosition(a,t+1,n+1)&&o.push({pos:e,move:"bomb",explosives:n+1,boulders:a})}}return o}search(e,t){let s=!0;for(const[t,n]of this.goals)if(!e.boulders.find(e=>e[0]===t&&e[1]===n)){s=!1;break}if(s)return[e];if(t>=this._depthLimit)return;if(Date.now()>this._forceStop)return;const o=this.getPossibleMoves(e,t);let n=null;for(const i of o){const s=this.search(i,t+1);if(s){const o=[e,...s];let i=o[o.length-1].explosives;if((!n||i<n[n.length-1].explosives||i===n[n.length-1].explosives&&o.length<n.length)&&(n=o,this._explosiveLimit=i,this._explosiveLimit===0)){let e=t+n.length-2;if(this._depthLimit=e,n.length===2)break}}}return n}}const s=200;class o{constructor(t){this.layout=[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1]],this.goals=[[4,-1],[5,-1]],this.boulders=[[0,-1],[1,-1],[2,-1],[3,-1]],this.engine=new n,this.solutionStep=0,this.solution=[],this.findSolution=e(this.findSolution.bind(this),s),this.gridContainer=t.querySelector(".boulder-solver-grid"),this.gridContainer.addEventListener("mousedown",this.onMouseDown.bind(this)),this.gridContainer.addEventListener("mousemove",this.onMouseMove.bind(this)),this.gridContainer.addEventListener("contextmenu",e=>e.preventDefault()),window.addEventListener("mouseup",this.onMouseUp.bind(this)),this.toolbarContainer=t.querySelector(".boulder-solver-toolbar-area"),this.toolbarContainer.addEventListener("mousedown",this.onMouseDown.bind(this)),this.toolbarContainer.addEventListener("mousemove",this.onMouseMove.bind(this)),this.indicator=t.querySelector(".boulder-solver-indicator"),this.bruteButton=t.querySelector(".boulder-solver-brute"),this.prevButton=t.querySelector(".boulder-solver-prev"),this.nextButton=t.querySelector(".boulder-solver-next"),this.prevButton.addEventListener("click",e=>{this.solutionStep--,this.renderSolutionNavigation(),this.renderPuzzle()}),this.nextButton.addEventListener("click",e=>{this.solutionStep++,this.renderSolutionNavigation(),this.renderPuzzle()}),this.bruteButton.addEventListener("click",e=>{this.bruteButton.innerHTML="Searching...",this.clearSolution(!0),this.findSolution(10,15)}),this.bruteButton.defaultText=this.bruteButton.innerHTML,this.drawElements=[],this.barElements=[];for(let e=0;e<10;e++){this.drawElements.push([]);for(let n=0;n<10;n++){let t=document.createElement("div");t.classList.add("boulder-solver-tile"),t.style.setProperty("--x",n),t.style.setProperty("--y",e),this.gridContainer.appendChild(t),this.drawElements[e][n]=t}let t=document.createElement("div");t.classList.add("boulder-solver-tile"),t.style.setProperty("--x",e),this.toolbarContainer.appendChild(t),this.barElements[e]=t}this.dragging=!1,this.renderPuzzle()}getMouseTile(e){let t=-1;e.target===this.gridContainer&&(t=Math.min(9,Math.max(0,Math.floor(e.offsetY/32))));let n=Math.min(9,Math.max(0,Math.floor(e.offsetX/32)));return[n,t]}getBoulderOnTile(e,t){let n=this.boulders;return this.solution.length&&this.solutionStep>0&&(n=[...this.solution[this.solutionStep].boulders,...this.boulders.filter(([e,t])=>t===-1)]),n.findIndex(([n,s])=>n===e&&s===t)}getGoalOnTile(e,t){return this.goals.findIndex(([n,s])=>n===e&&s===t)}onMouseDown(e){e.preventDefault();let[n,t]=this.getMouseTile(e),s=this.getBoulderOnTile(n,t);if(s>=0){this.dragging=["boulder",s],this.solutionStep>0&&(this.clearSolution(),this.findSolution());return}let o=this.getGoalOnTile(n,t);if(o>=0){this.dragging=["goal",o],this.solutionStep>0&&(this.clearSolution(),this.findSolution());return}if(t===-1)return;if(n===0||t===0||n===9||t===9)e.button===0?this.dragging=["tile",1]:e.button===2&&(this.dragging=["tile",0]);else{if(e.button===0){let e=this.layout[t][n]===1?2:1;this.layout[t][n]=e,this.dragging=["tile",e]}else if(e.button===2)this.layout[t][n]=0,this.dragging=["tile",0];else return;this.clearSolution(),this.updatePuzzle()}}onMouseUp(e){e.buttons&3||(this.dragging=!1)}onMouseMove(e){let[n,t]=this.getMouseTile(e);if(e.buttons&3||(this.dragging=!1),this.dragging){const o=this.layout,[s,e]=this.dragging;if(t!==-1&&(n===0||t===0||n===9||t===9))return;if(s==="boulder"){if(t!==-1){if([2].indexOf(o[t][n])>=0)return}else if(this.getGoalOnTile(n,t)>=0)return;if(this.getBoulderOnTile(n,t)>=0)return;const[s,i]=this.boulders[e];(s!==n||i!==t)&&(this.clearSolution(),this.boulders[e][0]=n,this.boulders[e][1]=t,this.updatePuzzle())}else if(s==="goal"){if(t!==-1){if([1,2].indexOf(o[t][n])>=0)return}else if(this.getBoulderOnTile(n,t)>=0)return;if(this.getGoalOnTile(n,t)>=0)return;const[s,i]=this.goals[e];(s!==n||i!==t)&&(this.clearSolution(),this.goals[e][0]=n,this.goals[e][1]=t,this.updatePuzzle())}else if(s==="tile"){if(t===-1)return;if((e===1||e===2)&&this.getGoalOnTile(n,t)>=0)return;if(e===2&&this.getBoulderOnTile(n,t)>=0)return;this.layout[t][n]=e,this.clearSolution(),this.updatePuzzle()}}}renderTile(e,t,n){let s;n===-1?s=this.barElements[t]:s=this.drawElements[n][t],n!==-1&&(s.dataset.tile=e[n][t]),this.goals.find(([e,s])=>e===t&&s===n)?s.dataset.hasGoal=!0:delete s.dataset.hasGoal;let o=this.boulders;this.solution.length&&this.solutionStep>0&&(o=[...this.solution[this.solutionStep].boulders,...this.boulders.filter(([e,t])=>t===-1)]),o.find(([e,s])=>e===t&&s===n)?s.dataset.hasBoulder=!0:delete s.dataset.hasBoulder}renderPuzzle(){const e=this.layout;for(let t=0;t<10;t++){for(let n=0;n<10;n++)this.renderTile(e,t,n);this.renderTile(e,t,-1)}}renderSolutionNavigation(){this.prevButton.disabled=this.solutionStep===0,this.nextButton.disabled=this.solutionStep>=this.solution.length-1;const e=this.solution[this.solutionStep+1];if(e){this.indicator.style.visibility="visible";const[t,n]=e.pos;this.indicator.style.setProperty("--x",t),this.indicator.style.setProperty("--y",n),this.indicator.dataset.move=e.move}else this.indicator.style.visibility="hidden"}clearSolution(e=!1){e||this.solution.length&&this.solutionStep>0&&(this.boulders=[...this.solution[this.solutionStep].boulders,...this.boulders.filter(([e,t])=>t===-1)]),this.solution=[],this.solutionStep=0,this.bruteButton.disabled=!0,this.renderSolutionNavigation(),e&&this.renderPuzzle()}updatePuzzle(){this.renderPuzzle(),this.findSolution()}findSolution(e=1,t=10,n=2){this.engine.prepare(this.layout,this.boulders,this.goals);let{solution:s,stats:o}=this.engine.run(e,t,n);console.log(`Tried ${o.positions} unique positions in ${o.duration}ms`),this.solution=s,this.solutionStep=0,this.renderSolutionNavigation(),this.bruteButton.disabled=e!==1||this.solution.length&&s[s.length-1].explosives===0,this.bruteButton.innerHTML=this.bruteButton.defaultText}}document.addEventListener("DOMContentLoaded",function(){var n,s,i,a,e=["checkbox","radio"];document.addEventListener("keypress",function(t){if(t.code!=="Space")return;var n,o,s=document.activeElement;if(s.tagName.toLowerCase()!=="label")return;s.htmlFor.length?(n=document.getElementById(s.htmlFor),n&&n.type&&e.indexOf(n.type.toLowerCase())!==-1&&n.click()):(o=s.querySelector(e.join(",")),o&&o.click())}),n=document.querySelectorAll(".poi");for(i of n)t(i);s=document.querySelectorAll(".boulder-solver");for(a of s)new o(a)})})()