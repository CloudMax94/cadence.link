{{- /* Find all heading tags on the page */ -}}
{{- $headers := findRE "<h[1-6].*?>(.|\n])+?</h[1-6]>" .Content -}}
{{- /* Must have at least one header for TOC to appear */ -}}
{{- if ge (len $headers) 1 -}}
  {{- partial "dropdown/open" (dict "class" "settings-wrap") -}}
    {{- range $headers -}}
      {{- $header := . -}} {{/* Heading HTML */}}
      {{- $level := substr $header 2 1 }} {{/* Heading level. Offset is 2 to skip past `<h` and get the level. */ -}}
      {{- $anchorId := $header | plainify | htmlUnescape | anchorize }} {{/* This must match the heading ID generated by Hugo */ -}}
      {{- $url := print "#" $anchorId }} {{/* Join # and anchor ID to make the URL */ -}}
      {{- $label := $header | plainify | htmlUnescape }} {{/* Strip all HTML and unscape HTML escape characters */ -}}
      {{- partial "dropdown/item" (dict "url" $url "label" $label "class" (print "toc-item toc-" $level)) -}}
    {{- end -}}
  {{- partial "dropdown/close" -}}
{{- end -}}
